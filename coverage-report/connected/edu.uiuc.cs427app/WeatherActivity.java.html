<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WeatherActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">edu.uiuc.cs427app</a> &gt; <span class="el_source">WeatherActivity.java</span></div><h1>WeatherActivity.java</h1><pre class="source lang-java linenums">package edu.uiuc.cs427app;

import android.accounts.Account;
import android.content.Intent;
import android.database.Cursor;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.TextView;
//import java.net.http.HttpResponse;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

import androidx.appcompat.app.AppCompatActivity;

import com.google.android.material.button.MaterialButton;

import org.json.JSONObject;
import org.w3c.dom.Text;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;

import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;


<span class="fc" id="L37">public class WeatherActivity extends AppCompatActivity {</span>

    private Account account;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="fc" id="L43">        super.onCreate(savedInstanceState);</span>
<span class="fc" id="L44">        account = getIntent().getParcelableExtra(&quot;account&quot;);</span>
<span class="fc" id="L45">        ThemeUtils.applyTheme(account, this);</span>
<span class="fc" id="L46">        setContentView(R.layout.activity_weather);</span>

        // Load in the passed values from the previous activity
<span class="fc" id="L49">        String cityName = getIntent().getStringExtra(&quot;city&quot;);</span>
<span class="fc" id="L50">        double latitude = getIntent().getDoubleExtra(&quot;lat&quot;,-34);</span>
<span class="fc" id="L51">        double longitude = getIntent().getDoubleExtra(&quot;lon&quot;,151);</span>

<span class="fc" id="L53">        String date_and_time = new java.util.Date().toString();</span>
<span class="fc" id="L54">        String solo_name = cityName.split(&quot;,&quot;, 2)[0];</span>


        // Views to set upon initiation of this activity
<span class="fc" id="L58">        TextView cityNameView = findViewById(R.id.CityName);</span>
<span class="fc" id="L59">        TextView weatherTemp = findViewById(R.id.CityTemperature);</span>
<span class="fc" id="L60">        TextView weatherTempRange = findViewById(R.id.CityTemperatureRange);</span>
<span class="fc" id="L61">        TextView weatherType = findViewById(R.id.CityWeather);</span>
<span class="fc" id="L62">        TextView windInfo = findViewById(R.id.windData);</span>
<span class="fc" id="L63">        TextView humidInfo = findViewById(R.id.humidityData);</span>
<span class="fc" id="L64">        TextView dewInfo = findViewById(R.id.dewPointData);</span>
<span class="fc" id="L65">        TextView PrecipitationInfo = findViewById(R.id.PrecipitationData);</span>
<span class="fc" id="L66">        TextView PrecipitationChanceInfo = findViewById(R.id.PrecipitationChanceData);</span>
<span class="fc" id="L67">        TextView UVInfo = findViewById(R.id.UVData);</span>
<span class="fc" id="L68">        TextView AirInfo = findViewById(R.id.AirData);</span>

<span class="fc" id="L70">        TextView date = findViewById(R.id.date_and_time);</span>
<span class="fc" id="L71">        date.setText(date_and_time);</span>

        // [MUST HAPPEN FIRST TO MAINTAIN APP RESPONSIVENESS]
        // Set weather data using pre-fetched metrics in database
<span class="fc" id="L75">        String selection = DataStore.WeatherEntry.COL_CITY+&quot; = '&quot;+cityName+&quot;'&quot;;</span>
<span class="fc" id="L76">        Cursor cursor = getContentResolver().query(DataStore.WeatherEntry.CONTENT_URI, null,</span>
                selection, null, null);

<span class="pc bpc" id="L79" title="1 of 2 branches missed.">        if(cursor.moveToFirst()) {</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">            while (!cursor.isAfterLast()) {</span>
<span class="fc" id="L81">                String cityStateName = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_CITY));</span>
<span class="fc" id="L82">                String city = cityStateName.split(&quot;,&quot;, 2)[0];</span>
<span class="fc" id="L83">                String temperature = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_TEMPERATURE));</span>
<span class="fc" id="L84">                String temperatureMax = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_TEMPERATUREMAX));</span>
<span class="fc" id="L85">                String temperatureMin = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_TEMPERATUREMIN));</span>
<span class="fc" id="L86">                String weatherDescription = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_DESCRIPTION));</span>
<span class="fc" id="L87">                String wind = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_WINDSPEED));</span>
<span class="fc" id="L88">                String humidity = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_HUMIDITY));</span>
<span class="fc" id="L89">                String dewPoint = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_DEWPOINT));</span>
<span class="fc" id="L90">                String UV = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_UV));</span>
<span class="fc" id="L91">                String Air = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_AIRINDEX));</span>
<span class="fc" id="L92">                String precipitation = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_PRECIPITATION));</span>
<span class="fc" id="L93">                String precipitationChance = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_PRECIPITATIONCHANCE));</span>

<span class="fc" id="L95">                cityNameView.setText(city);</span>
<span class="fc" id="L96">                weatherTemp.setText(temperature + &quot;°C&quot;);</span>
<span class="fc" id="L97">                weatherTempRange.setText(&quot;H:&quot; + temperatureMax + &quot;°C&quot; + &quot; L:&quot; + temperatureMin + &quot;°C&quot;);</span>
<span class="fc" id="L98">                weatherType.setText(weatherDescription);</span>
<span class="fc" id="L99">                windInfo.setText(wind + &quot; mph&quot;);</span>
<span class="fc" id="L100">                humidInfo.setText(humidity  + &quot;%&quot;);</span>
<span class="fc" id="L101">                dewInfo.setText(&quot;dew point is &quot; + dewPoint + &quot;°C now&quot;);</span>
<span class="fc" id="L102">                UVInfo.setText(UV);</span>
<span class="fc" id="L103">                AirInfo.setText(Air);</span>
<span class="fc" id="L104">                PrecipitationInfo.setText(precipitation + &quot; inch&quot;);</span>
<span class="fc" id="L105">                PrecipitationChanceInfo.setText(precipitationChance + &quot;%&quot;);</span>
<span class="fc" id="L106">                Log.v(&quot;Render Finish&quot;, &quot;Weather metrics updated.&quot;);</span>
<span class="fc" id="L107">                cursor.moveToNext();</span>
<span class="fc" id="L108">            }</span>
        }
<span class="fc" id="L110">        cursor.close();</span>

        // Update weather data if database metrics are outdated and set respective fields
        // TODO (post Milestone 4) add timestamp to database for weather metric entries and use the
        //  predetermined cutoff (say ~5 mins?) to determine if updating values is to take place
        if (true) {
<span class="fc" id="L116">            Log.v(&quot;Render Start&quot;, &quot;Updating database with weather metrics from server.&quot;);</span>
<span class="fc" id="L117">            Weather.fetch(getApplicationContext(), cityName, latitude, longitude);</span>

            // Set weather data using pre-fetched metrics in database
<span class="fc" id="L120">            selection = DataStore.WeatherEntry.COL_CITY+&quot; = '&quot;+cityName+&quot;'&quot;;</span>
<span class="fc" id="L121">            cursor = getContentResolver().query(DataStore.WeatherEntry.CONTENT_URI, null,</span>
                    selection, null, null);

<span class="pc bpc" id="L124" title="1 of 2 branches missed.">            if(cursor.moveToFirst()) {</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">                while (!cursor.isAfterLast()) {</span>
<span class="fc" id="L126">                    String cityStateName = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_CITY));</span>
<span class="fc" id="L127">                    String city = cityStateName.split(&quot;,&quot;, 2)[0];</span>
<span class="fc" id="L128">                    String temperature = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_TEMPERATURE));</span>
<span class="fc" id="L129">                    String temperatureMax = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_TEMPERATUREMAX));</span>
<span class="fc" id="L130">                    String temperatureMin = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_TEMPERATUREMIN));</span>
<span class="fc" id="L131">                    String weatherDescription = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_DESCRIPTION));</span>
<span class="fc" id="L132">                    String wind = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_WINDSPEED));</span>
<span class="fc" id="L133">                    String humidity = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_HUMIDITY));</span>
<span class="fc" id="L134">                    String dewPoint = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_DEWPOINT));</span>
<span class="fc" id="L135">                    String UV = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_UV));</span>
<span class="fc" id="L136">                    String Air = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_AIRINDEX));</span>
<span class="fc" id="L137">                    String precipitation = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_PRECIPITATION));</span>
<span class="fc" id="L138">                    String precipitationChance = cursor.getString(cursor.getColumnIndexOrThrow(DataStore.WeatherEntry.COL_PRECIPITATIONCHANCE));</span>

<span class="fc" id="L140">                    cityNameView.setText(city);</span>
<span class="fc" id="L141">                    weatherTemp.setText(temperature + &quot;°C&quot;);</span>
<span class="fc" id="L142">                    weatherTempRange.setText(&quot;H:&quot; + temperatureMax + &quot;°C&quot; + &quot; L:&quot; + temperatureMin + &quot;°C&quot;);</span>
<span class="fc" id="L143">                    weatherType.setText(weatherDescription);</span>
<span class="fc" id="L144">                    windInfo.setText(wind + &quot; mph&quot;);</span>
<span class="fc" id="L145">                    humidInfo.setText(humidity  + &quot;%&quot;);</span>
<span class="fc" id="L146">                    dewInfo.setText(&quot;dew point is &quot; + dewPoint + &quot;°C now&quot;);</span>
<span class="fc" id="L147">                    UVInfo.setText(UV);</span>
<span class="fc" id="L148">                    AirInfo.setText(Air);</span>
<span class="fc" id="L149">                    PrecipitationInfo.setText(precipitation + &quot; inch&quot;);</span>
<span class="fc" id="L150">                    PrecipitationChanceInfo.setText(precipitationChance + &quot;%&quot;);</span>
<span class="fc" id="L151">                    Log.v(&quot;Render Finish&quot;, &quot;Weather metrics updated (post server calls &amp; database updates).&quot;);</span>
<span class="fc" id="L152">                    cursor.moveToNext();</span>
<span class="fc" id="L153">                }</span>
            }
<span class="fc" id="L155">            cursor.close();</span>
        }

<span class="fc" id="L158">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 7.4.2</div></body></html>